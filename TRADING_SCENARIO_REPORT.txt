[TwinStar Quantum] 매매 시나리오 및 문제 해결 보고서

1. VS Code "Service Worker" 오류 해결 방법
----------------------------------------
이 오류는 VS Code 내부의 웹뷰(Markdown 미리보기 등) 구성 요소가 정상적으로 로드되지 않을 때 발생합니다.

해결 방법:
1) VS Code 화면 새로고침:
   - 'Ctrl + Shift + P' 커맨드 팔레트 실행
   - 'Developer: Reload Window' 입력 후 실행
2) 캐시 강제 삭제 (Windows):
   - VS Code를 완전히 종료합니다.
   - 윈도우 탐색기 주소창에 다음 경로를 복사하여 이동합니다:
     %AppData%\Code\Service Worker
   - 해당 폴더 내의 모든 내용을 삭제한 후 VS Code를 다시 시작합니다.
3) VS Code 업데이트 확인:
   - 상단 메뉴 [Help] -> [Check for Updates]를 통해 최신 버전인지 확인합니다.


2. 매매 시나리오 (MACD vs ADX/DI)
----------------------------------------
사용자 요청 시나리오: "4시간 필터 적용 + 1시간 W 패턴 감지 + 15분 진입 매매"

[시나리오 A: MACD 기반 W 패턴]
- 작동 원리: MACD Histogram의 음/양 전환을 통해 저점(L)과 고점(H)을 추출하여 L-H-L 형태의 W 패턴을 찾습니다.
- 4시간 필터: strategy_core.py의 get_filter_trend() 로직 사용. 4시간봉의 EMA(20) 또는 MACD 추세를 확인하여 '롱' 방향일 때만 진입을 허용합니다.
- 데이터 처리: 15분 원본 데이터를 1시간 단위로 리샘플링하여 패턴을 분석합니다.
- 진입 시점: 1시간 W 패턴이 확정(Confirmed)된 직후, 다음 15분 봉의 시가(Open)로 진입합니다.

* 매커니즘: Histogram Segments -> W/M Points -> MTF Trend Filter -> 15m Entry


[시나리오 B: ADX/DI 기반 추세 추종]
- 작동 원리: +DI선과 -DI선의 골든크로스(+DI가 -DI를 상향 돌파)를 저점으로 인식합니다.
- 4시간 필터: 4시간봉의 ADX 값이 25 이상(강한 추세)일 때만 매매가 활성화되도록 설정합니다.
- 데이터 처리: 동일하게 15분 데이터를 1시간으로 리샘플링하여 크로스오버를 감지합니다.
- 진입 시점: 패턴 확인 후 진입 타임프레임(15m)에서 즉시 주문을 실행합니다.


3. 프리셋(Preset) 활용 및 저장 위치
----------------------------------------
- 저장 경로: f:\TwinStar-Quantum\config\presets\
- 파일 형식: .json
- 특징: 봇 실행 시 {거래소}_{심볼}_optimized.json 또는 지정된 프리셋 파일을 자동으로 로드하여 전략에 반영합니다.

[프리셋 예시 (MACD)]
{
  "strategy": "macd",
  "filter_tf": "4h",
  "entry_tf": "15m",
  "pattern_tolerance": 0.05,
  "atr_mult": 1.25,
  "leverage": 10
}


4. 감시 범위 (Monitoring Range) 상세
----------------------------------------
패턴을 감시하고 진입을 결정하는 범위는 크게 세 가지 기준으로 나뉩니다.

1) 데이터 분석 범위 (Lookback Window)
   - 최소 감시: 최근 50개 캔들 (패턴 분석을 위한 최소 데이터)
   - 메모리 상주: 최근 1,000개 캔들 (실시간 계산 및 지표 산출용)
   - 15분봉 기준 약 10.4일, 1시간봉 기준 약 41일 분량의 데이터를 상시 감시합니다.

2) 패턴 유효 범위 (Entry Validity)
   - 파라미터: entry_validity_hours (기본값: 6시간 ~ 12시간)
   - 설명: W/M 패턴이 완성된 후, 실제 진입이 가능한 유효 시간입니다. 
     예를 들어 6시간으로 설정된 경우, 6시간 이전에 발생한 패턴은 "이미 지나간 기회"로 간주하여 진입하지 않습니다.

3) 가격 오차 범위 (Pattern Tolerance)
   - 파라미터: pattern_tolerance (기본값: 0.05 / 5%)
   - 설명: W 패턴의 첫 번째 저점과 두 번째 저점의 가격 차이가 이 범위 내에 있어야만 유효한 패턴으로 감시/인정합니다.


5. 결론 및 제언
----------------------------------------
현재 시스템은 15분 데이터를 단일 소스로 사용하여 모든 리샘플링을 처리하므로, 사용자가 보고 계신 15분 캔들 데이터만으로도 4시간 필터와 1시간 패턴 분석이 백테스트와 동일하게 동작합니다.

작성일: 2026-01-15
작성자: Antigravity AI
