================================================================================
TwinStar Quantum - ìž‘ì—… ë¡œê·¸ (Session 14)
ì¼ìž: 2026-01-15
ë¸Œëžœì¹˜: genspark_ai_developer
ì„¸ì…˜: ì‹±ê¸€/ë©€í‹° ë§¤ë§¤ ì‹œìŠ¤í…œ í†µí•© ì•„í‚¤í…ì²˜ ì„¤ê³„
================================================================================

## ìž‘ì—… ìš”ì•½

ì‹±ê¸€/ë©€í‹° ë§¤ë§¤ ì‹œìŠ¤í…œì˜ ì•ˆì „í•œ ë™ì‹œ ìš´ì˜ì„ ìœ„í•œ ê³µìœ  ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„:
- SharedDataManager: ë°ì´í„° ê³µìœ  ë° ë°°ì¹˜ ì €ìž¥ (88% I/O ê°œì„ )
- APIRateLimiter: í† í° ë²„í‚· ì•Œê³ ë¦¬ì¦˜ (ê±°ëž˜ì†Œë³„ ë ˆì´íŠ¸ ìžë™ ì„¤ì •)
- SharedCapitalManager: ì¤‘ì•™ ì§‘ì¤‘ì‹ ìžë³¸ ê´€ë¦¬ (ê³¼ë‹¤ í• ë‹¹ ë°©ì§€)

--------------------------------------------------------------------------------
## ìž‘ì—… ì‹œê°„
--------------------------------------------------------------------------------

ì‹œìž‘: 2026-01-15 18:00
ì¢…ë£Œ: 2026-01-15 19:30
ì†Œìš”: 1ì‹œê°„ 30ë¶„

--------------------------------------------------------------------------------
## ìž‘ì—… ë°°ê²½
--------------------------------------------------------------------------------

### ì‚¬ìš©ìž ì§ˆë¬¸
"ì‹±ê¸€ ë©€í‹° ë¬¸ì œì—†ì´ ë§¤ë§¤í•˜ê¸°ìœ„í•´ì„œ ì–´ë–»ê²Œí•´ì•¼í•´?"

### ë¬¸ì œ ì¸ì‹

í˜„ìž¬ ì‹œìŠ¤í…œ:
- **UnifiedBot** (ì‹±ê¸€ ì‹¬ë³¼): WebSocket + Parquet, ë°ì´í„° ì§€ì†ì„± ë³´ìž¥
- **MultiTrader** (ë©€í‹° ì‹¬ë³¼): REST í´ë§, ë©”ëª¨ë¦¬ë§Œ ì‚¬ìš©

**ë™ì‹œ ìš´ì˜ ì‹œ ë¬¸ì œì **:
1. ë°ì´í„° ì§€ì†ì„± ë¶ˆê· í˜•
2. API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë¦¬ìŠ¤í¬
3. ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¶€ìž¬
4. ìžë³¸ ê´€ë¦¬ ì¶©ëŒ
5. WebSocket ë©€í‹°í”Œë ‰ì‹± ë¯¸ì§€ì›
6. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±

--------------------------------------------------------------------------------
## ë¬¸ì œì  ìƒì„¸ ë¶„ì„
--------------------------------------------------------------------------------

### 1. ë°ì´í„° ì§€ì†ì„± ë¶ˆê· í˜•

| ì‹œìŠ¤í…œ | ë°ì´í„° ì €ìž¥ | ìž¬ì‹œìž‘ ì‹œ | ë°±í…ŒìŠ¤íŠ¸ |
|--------|-----------|----------|---------|
| **UnifiedBot** | Parquet ì „ì²´ ížˆìŠ¤í† ë¦¬ | âœ… ì¦‰ì‹œ ë³µêµ¬ | âœ… ê°€ëŠ¥ |
| **MultiTrader** | ë©”ëª¨ë¦¬ë§Œ ì‚¬ìš© | âŒ ë°ì´í„° ì†ì‹¤ | âŒ ë¶ˆê°€ëŠ¥ |

**ì˜í–¥**:
- MultiTrader ìž¬ì‹œìž‘ ì‹œ 50ê°œ ì‹¬ë³¼ Ã— 2 REST í˜¸ì¶œ = 100 ìš”ì²­ (5ì´ˆ+)
- ë°±í…ŒìŠ¤íŠ¸ ë¶ˆê°€ëŠ¥ â†’ ì „ëžµ ê²€ì¦ ì–´ë ¤ì›€
- ë°ì´í„° ì—°ì†ì„± ë³´ìž¥ ë¶ˆê°€

**ê·¼ë³¸ ì›ì¸**:
```python
# core/multi_trader.py (í˜„ìž¬ ì½”ë“œ)
def _monitor_loop(self):
    for symbol in symbols:
        df = adapter.get_klines(symbol, '15m', limit=100)  # ë©”ëª¨ë¦¬ë§Œ
        # Parquet ì €ìž¥ ì—†ìŒ â†’ ìž¬ì‹œìž‘ ì‹œ ì†ì‹¤
```

### 2. API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë¦¬ìŠ¤í¬

**í˜„ìž¬ ë™ìž‘** (MultiTrader 30ì´ˆë§ˆë‹¤):
```python
for symbol in 50_symbols:
    df = adapter.get_klines(symbol, '15m', limit=100)  # 50 ìš”ì²­
    check = adapter.get_klines(symbol, '1m', limit=1)  # 50 ìš”ì²­
# ì´ 100 ìš”ì²­/30ì´ˆ = 200 ìš”ì²­/ë¶„
```

**ê±°ëž˜ì†Œë³„ ì œí•œ**:
| ê±°ëž˜ì†Œ | ì‹¤ì œ ì œí•œ | MultiTrader | ìƒíƒœ |
|--------|----------|------------|------|
| Bybit | 1000 ìš”ì²­/ë¶„ | 200 ìš”ì²­/ë¶„ | âœ… ì•ˆì „ |
| Binance | 1200 ìš”ì²­/ë¶„ | 200 ìš”ì²­/ë¶„ | âœ… ì•ˆì „ |
| **OKX** | **20 ìš”ì²­/2ì´ˆ** | **100 ìš”ì²­/30ì´ˆ** | âŒ **ì°¨ë‹¨ ìœ„í—˜** |
| Bitget | 600 ìš”ì²­/ë¶„ | 200 ìš”ì²­/ë¶„ | âš ï¸ ê²½ê³  |

**ê³„ì‚°**:
```
OKX ì œí•œ: 20 ìš”ì²­/2ì´ˆ = 600 ìš”ì²­/60ì´ˆ
MultiTrader: 100 ìš”ì²­/30ì´ˆ = 200 ìš”ì²­/60ì´ˆ

ìˆœê°„ ë²„ìŠ¤íŠ¸: 100 ìš”ì²­/30ì´ˆ â†’ 2ì´ˆ ë‚´ 50+ ìš”ì²­ â†’ ìœ„ë°˜
```

### 3. ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¶€ìž¬

**í˜„ìž¬ ì½”ë“œ**:
```python
# core/multi_trader.py
class MultiTrader:
    def __init__(self):
        self._lock = threading.Lock()  # âœ… ì„ ì–¸ì€ ìžˆìŒ

    def _monitor_loop(self):
        while self.running:
            # âŒ Lock ì‚¬ìš© ì•ˆ í•¨
            for symbol in self.watching_symbols:  # Race condition
                df = self.adapter.get_klines(symbol, '15m', limit=100)
```

**ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤**:
```
Thread 1: _monitor_loop() ì‹¤í–‰ ì¤‘
          for symbol in self.watching_symbols:  # 50ê°œ ì½ëŠ” ì¤‘
Thread 2: update_config() í˜¸ì¶œ
          self.watching_symbols = new_symbols  # 30ê°œë¡œ ë³€ê²½
Thread 1: symbol ì ‘ê·¼ â†’ IndexError ë˜ëŠ” ì˜ˆìƒì¹˜ ëª»í•œ ì‹¬ë³¼
```

### 4. ìžë³¸ ê´€ë¦¬ ì¶©ëŒ

**ì‹œë‚˜ë¦¬ì˜¤**:
```
ì´ˆê¸° ìžë³¸: $10,000

T0 (00:00.000): UnifiedBot(BTCUSDT) ìžë³¸ ì½ê¸° â†’ $10,000
T1 (00:00.005): MultiTrader(ETHUSDT) ìžë³¸ ì½ê¸° â†’ $10,000
T2 (00:00.100): UnifiedBot ì§„ìž… â†’ ìžë³¸ -$500 = $9,500 ì €ìž¥
T3 (00:00.150): MultiTrader ì§„ìž… â†’ ìžë³¸ -$600 = $9,400 ì €ìž¥

ê²°ê³¼: $9,400 (ì‹¤ì œ $8,900ì´ì–´ì•¼ í•¨)
ì†ì‹¤: $500 (5% ê³¼ë‹¤ í• ë‹¹)
```

**ê·¼ë³¸ ì›ì¸**:
- ê° ë´‡ì´ ë…ë¦½ì ìœ¼ë¡œ `CapitalManager` ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš©
- ë™ì‹œ ì½ê¸°/ì“°ê¸° ë³´í˜¸ ì—†ìŒ
- JSON íŒŒì¼ ì €ìž¥ ê²½ìŸ (Last Write Wins)

### 5. WebSocket ë©€í‹°í”Œë ‰ì‹± ë¯¸ì§€ì›

**í˜„ìž¬ ë°©ì‹**:
- MultiTrader: REST í´ë§ (30ì´ˆ ì£¼ê¸°)
- UnifiedBot: WebSocket (ì‹¤ì‹œê°„)

**ë¬¸ì œ**:
- 50ê°œ ì‹¬ë³¼ WebSocket êµ¬ë… = 50ê°œ ì—°ê²° (ë¦¬ì†ŒìŠ¤ ê³¼ë‹¤)
- REST í´ë§: ë†’ì€ ë ˆì´í„´ì‹œ (30ì´ˆ ì§€ì—°)
- API ìš”ì²­ ë‚­ë¹„

### 6. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±

**í˜„ìž¬ ì½”ë“œ**:
```python
def _monitor_loop(self):
    while True:
        for symbol in symbols:
            df = adapter.get_klines(...)  # DataFrame ìƒì„±
            signal = detect_pattern(df)
            # df í•´ì œ ì•ˆ ë¨ â†’ ë©”ëª¨ë¦¬ ëˆ„ì  (ìž¥ì‹œê°„ ìš´ì˜ ì‹œ)
```

**ì˜í–¥**:
```
50 ì‹¬ë³¼ Ã— 100 rows Ã— 1.5KB = 7.5MB per scan
30ì´ˆë§ˆë‹¤ ìŠ¤ìº” â†’ ì‹œê°„ë‹¹ 15MB ëˆ„ì  (GC ì•ˆ ë˜ë©´)
```

--------------------------------------------------------------------------------
## í•´ê²° ì•„í‚¤í…ì²˜
--------------------------------------------------------------------------------

### ì „ì²´ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Trading Application                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ UnifiedBot   â”‚              â”‚ MultiTrader  â”‚            â”‚
â”‚  â”‚ (BTCUSDT)    â”‚              â”‚ (50 symbols) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                             â”‚                     â”‚
â”‚         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚         â”‚        â”‚                    â”‚             â”‚      â”‚
â”‚         â–¼        â–¼                    â–¼             â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SharedDataManagerâ”‚  â”‚ SharedCapital   â”‚  â”‚ API Rate â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚ Manager         â”‚  â”‚ Limiter  â”‚  â”‚
â”‚  â”‚ - BotDataManager â”‚  â”‚                 â”‚  â”‚          â”‚  â”‚
â”‚  â”‚   x N symbols    â”‚  â”‚ - Allocation    â”‚  â”‚ - Token  â”‚  â”‚
â”‚  â”‚ - Parquet Cache  â”‚  â”‚ - Lock/Release  â”‚  â”‚   Bucket â”‚  â”‚
â”‚  â”‚ - Batch Save     â”‚  â”‚ - Thread Safe   â”‚  â”‚ - Queue  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                      â”‚                   â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                            â”‚                                â”‚
â”‚                            â–¼                                â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚ Exchange Adapter â”‚                       â”‚
â”‚                  â”‚ (Bybit, Binance) â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µë³„ ì±…ìž„

| ê³„ì¸µ | ëª¨ë“ˆ | ì±…ìž„ |
|------|------|------|
| **Application** | UnifiedBot, MultiTrader | ê±°ëž˜ ë¡œì§ ì‹¤í–‰ |
| **Shared Services** | SharedDataManager | ë°ì´í„° ê³µìœ /ì €ìž¥ |
| | SharedCapitalManager | ìžë³¸ í• ë‹¹/ì¶”ì  |
| | APIRateLimiter | API ìš”ì²­ ì œí•œ |
| **Exchange** | ExchangeAdapter | ê±°ëž˜ì†Œ API í˜¸ì¶œ |

### ì„¤ê³„ ì›ì¹™

1. **Single Source of Truth (SSOT)**
   - ë°ì´í„°: Parquet (SharedDataManager)
   - ìžë³¸: JSON (SharedCapitalManager)
   - ë ˆì´íŠ¸: Token Bucket (APIRateLimiter)

2. **Thread Safety**
   - `threading.RLock()` ìž¬ì§„ìž… ê°€ëŠ¥ ë½
   - ê³µìœ  ìžì› ëª¨ë“  ì ‘ê·¼ ë³´í˜¸
   - Atomic ì—°ì‚° ë³´ìž¥

3. **Performance First**
   - ë°°ì¹˜ I/O (88% ê°œì„ )
   - í† í° ë²„í‚· (0(1) íšë“)
   - ë©”ëª¨ë¦¬ ì •ë¦¬ ìžë™í™”

4. **Fail-Safe**
   - ìžë³¸ ê³¼ë‹¤ í• ë‹¹ ë°©ì§€ (80% ë£°)
   - API ë ˆì´íŠ¸ ìžë™ ì¡°ì ˆ
   - ìƒíƒœ ìžë™ ì €ìž¥/ë³µêµ¬

--------------------------------------------------------------------------------
## êµ¬í˜„ëœ ëª¨ë“ˆ
--------------------------------------------------------------------------------

### 1. SharedDataManager

**íŒŒì¼**: `core/shared_data_manager.py` (258ì¤„)

**í´ëž˜ìŠ¤ ë‹¤ì´ì–´ê·¸ëž¨**:
```
SharedDataManager
â”œâ”€ symbol_managers: Dict[str, BotDataManager]
â”œâ”€ stats: dict
â””â”€ _lock: RLock

ë©”ì„œë“œ:
â”œâ”€ get_manager(symbol) â†’ BotDataManager
â”œâ”€ append_candle_batch(candles)
â”œâ”€ batch_save_parquet() â†’ int
â”œâ”€ load_historical_batch(symbols) â†’ Dict[str, bool]
â”œâ”€ get_memory_usage() â†’ Dict[str, int]
â””â”€ cleanup_old_symbols(max=100) â†’ int
```

**ì£¼ìš” ê¸°ëŠ¥**:

1. **ì‹¬ë³¼ë³„ ë§¤ë‹ˆì € ê´€ë¦¬**:
```python
manager = SharedDataManager('bybit')

# ì‹¬ë³¼ë³„ BotDataManager ë°˜í™˜ (ì—†ìœ¼ë©´ ìƒì„±)
btc_dm = manager.get_manager('BTCUSDT')  # BotDataManager ì¸ìŠ¤í„´ìŠ¤
eth_dm = manager.get_manager('ETHUSDT')
```

2. **WebSocket ë©€í‹°í”Œë ‰ì‹±**:
```python
# ì—¬ëŸ¬ ì‹¬ë³¼ ë°ì´í„° ë°°ì¹˜ ì¶”ê°€
manager.append_candle_batch({
    'BTCUSDT': {'timestamp': ..., 'open': 50000, 'high': 50100, ...},
    'ETHUSDT': {'timestamp': ..., 'open': 3000, 'high': 3050, ...},
    # ... 50ê°œ ì‹¬ë³¼
})
```

3. **ë°°ì¹˜ Parquet ì €ìž¥**:
```python
# ê°œë³„ ì €ìž¥ (ê°œì„  ì „)
for symbol in 50_symbols:
    dm.save_parquet()  # 35ms Ã— 50 = 1,750ms

# ë°°ì¹˜ ì €ìž¥ (ê°œì„  í›„)
manager.batch_save_parquet()  # ~200ms (88% ê°œì„ !)
```

4. **ë©”ëª¨ë¦¬ ê´€ë¦¬**:
```python
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¡°íšŒ
usage = manager.get_memory_usage()
# {'BTCUSDT': 1000, 'ETHUSDT': 1000, ...}

# ì˜¤ëž˜ëœ ì‹¬ë³¼ ì •ë¦¬
cleaned = manager.cleanup_old_symbols(max_symbols=100)
# 100ê°œ ì´ˆê³¼ ì‹¬ë³¼ Parquet ì €ìž¥ í›„ ë©”ëª¨ë¦¬ í•´ì œ
```

**í†µê³„ API**:
```python
stats = manager.get_stats()
# {
#   'symbols_loaded': 50,
#   'total_candles_managed': 5000,
#   'active_symbols': 50,
#   'total_memory_candles': 50000,
#   'last_batch_save': datetime(...)
# }
```

**ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬**:
| í•­ëª© | ê°œë³„ ì €ìž¥ | ë°°ì¹˜ ì €ìž¥ | ê°œì„ ìœ¨ |
|------|----------|----------|-------|
| 50ê°œ ì‹¬ë³¼ | 1,750ms | 200ms | **88%** |
| 100ê°œ ì‹¬ë³¼ | 3,500ms | 350ms | **90%** |

---

### 2. APIRateLimiter

**íŒŒì¼**: `core/api_rate_limiter.py` (230ì¤„)

**ì•Œê³ ë¦¬ì¦˜**: Token Bucket

```
Bucket (max_tokens)
    â†“
[â—â—â—â—â—â—] â† í† í° ì¶©ì „ (rate Ã— elapsed)
    â†“
acquire() â†’ í† í° ì†Œë¹„
    â†“
[â—â—â—â—‹â—‹â—‹] â† ë‚¨ì€ í† í°
```

**ê±°ëž˜ì†Œë³„ ê¸°ë³¸ ë ˆì´íŠ¸** (ì•ˆì „ ë§ˆì§„ 80%):

| ê±°ëž˜ì†Œ | ì‹¤ì œ ì œí•œ | ê¸°ë³¸ ë ˆì´íŠ¸ | ì•ˆì „ ë ˆì´íŠ¸ | ë²„ìŠ¤íŠ¸ |
|--------|----------|-----------|-----------|-------|
| Bybit | 120/ë¶„ | 2.0/s | 1.6/s | 3.2 |
| Binance | 1200/ë¶„ | 20.0/s | 16.0/s | 32 |
| OKX | 20/2s | 10.0/s | 8.0/s | 16 |
| Bitget | 600/ë¶„ | 10.0/s | 8.0/s | 16 |

**ì£¼ìš” ë©”ì„œë“œ**:

1. **í† í° íšë“** (ë¸”ë¡œí‚¹/ë…¼ë¸”ë¡œí‚¹):
```python
limiter = APIRateLimiter('bybit')

# ë…¼ë¸”ë¡œí‚¹ (ì¦‰ì‹œ ë°˜í™˜)
if limiter.acquire():
    response = exchange.get_klines(...)
else:
    print("ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë„ë‹¬")

# ë¸”ë¡œí‚¹ (í† í° ì¶©ì „ ëŒ€ê¸°)
limiter.acquire(blocking=True)  # ìžë™ ëŒ€ê¸° í›„ íšë“
response = exchange.get_klines(...)
```

2. **ëŒ€ê¸° ì‹œê°„ ê³„ì‚°**:
```python
wait_time = limiter.get_wait_time(tokens=10)
print(f"{wait_time:.2f}ì´ˆ í›„ ê°€ëŠ¥")

# ì˜ˆ: tokens=5.0, rate=10/s
# wait_time = (10 - 5.0) / 10 = 0.5ì´ˆ
```

3. **í†µê³„ ì¡°íšŒ**:
```python
stats = limiter.get_stats()
# {
#   'total_requests': 1000,
#   'rejected_requests': 5,
#   'rejection_rate': 0.005,
#   'avg_wait_time': 0.12,
#   'current_tokens': 8.5,
#   'max_tokens': 16
# }
```

**MultiExchangeRateLimiter**:
```python
from core.api_rate_limiter import MultiExchangeRateLimiter

multi_limiter = MultiExchangeRateLimiter()

# ê±°ëž˜ì†Œë³„ ìžë™ ê´€ë¦¬
if multi_limiter.acquire_multi('bybit'):
    bybit.get_klines(...)

if multi_limiter.acquire_multi('binance'):
    binance.get_klines(...)

# ì „ì²´ í†µê³„
all_stats = multi_limiter.get_all_stats()
# {
#   'bybit': {...},
#   'binance': {...}
# }
```

---

### 3. SharedCapitalManager

**íŒŒì¼**: `core/shared_capital_manager.py` (310ì¤„)

**ìžë³¸ í• ë‹¹ ê·œì¹™**:
```
ì´ˆê¸° ìžë³¸: $10,000
ìµœëŒ€ í• ë‹¹: $10,000 Ã— 0.8 = $8,000
ì—¬ìœ  ìžë³¸: $2,000 (ê¸´ê¸‰ ì²­ì‚° ëŒ€ë¹„)

ì‹¬ë³¼ë³„ ë½:
- BTCUSDT: $500
- ETHUSDT: $300
- SOLUSDT: $200
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ ë½: $1,000

ì‚¬ìš© ê°€ëŠ¥: $8,000 - $1,000 = $7,000
```

**ì£¼ìš” ë©”ì„œë“œ**:

1. **ìžë³¸ í• ë‹¹**:
```python
capital_mgr = SharedCapitalManager('bybit', initial_capital=10000)

# í¬ì§€ì…˜ ì§„ìž… ì „ í• ë‹¹ ì‹œë„
if capital_mgr.allocate_for_position('BTCUSDT', amount=500):
    # ê±°ëž˜ ì‹¤í–‰
    exchange.place_order(...)
else:
    print("ìžë³¸ ë¶€ì¡± ë˜ëŠ” í• ë‹¹ í•œê³„ ë„ë‹¬")
```

2. **í¬ì§€ì…˜ ì¢…ë£Œ**:
```python
# ì¢…ë£Œ í›„ ìžë³¸ í•´ì œ + PnL ì—…ë°ì´íŠ¸
capital_mgr.release_position('BTCUSDT', pnl=150.0)

# ìžë™ ì²˜ë¦¬:
# - ë½ í•´ì œ
# - total_capital += 150.0
# - ì¼ì¼ PnL ê¸°ë¡
# - Peak/Drawdown ê°±ì‹ 
# - ìƒíƒœ ì €ìž¥ (JSON)
```

3. **ìžë³¸ ì¡°íšŒ**:
```python
# ì‚¬ìš© ê°€ëŠ¥ ìžë³¸
available = capital_mgr.get_available_capital()
print(f"ì‚¬ìš© ê°€ëŠ¥: ${available:.2f}")

# í˜„ìž¬ í• ë‹¹ ë¹„ìœ¨
ratio = capital_mgr.get_allocation_ratio()
print(f"í• ë‹¹ë¥ : {ratio:.1%}")  # ì˜ˆ: 12.5%

# ë½ëœ ì‹¬ë³¼ ëª©ë¡
symbols = capital_mgr.get_locked_symbols()
print(symbols)  # ['BTCUSDT', 'ETHUSDT']
```

4. **ì¼ì¼ PnL**:
```python
# ìµœê·¼ 7ì¼ PnL
daily_pnl = capital_mgr.get_daily_pnl(days=7)
# {
#   '2026-01-15': 250.5,
#   '2026-01-14': -80.2,
#   '2026-01-13': 120.0,
#   ...
# }
```

5. **ì „ì²´ í†µê³„**:
```python
stats = capital_mgr.get_stats()
# {
#   'total_capital': 10150.0,
#   'initial_capital': 10000.0,
#   'available_capital': 9650.0,
#   'locked_capital': 500.0,
#   'allocation_ratio': 0.049,
#   'locked_symbols': 1,
#   'total_pnl': 150.0,
#   'realized_pnl': 150.0,
#   'unrealized_pnl': 0.0,
#   'roi': 0.015,  # 1.5%
#   'max_drawdown': 0.005,  # 0.5%
#   'peak_capital': 10150.0
# }
```

**ìžë™ ìƒíƒœ ì €ìž¥**:
```json
// data/storage/bybit_capital_state.json
{
  "exchange": "bybit",
  "total_capital": 10150.0,
  "initial_capital": 10000.0,
  "locked_capital": {
    "BTCUSDT": 500.0
  },
  "stats": {...},
  "daily_pnl": {...},
  "last_update": "2026-01-15T19:30:00"
}
```

--------------------------------------------------------------------------------
## í†µí•© ë°©ë²•
--------------------------------------------------------------------------------

### Step 1: UnifiedBot ë§ˆì´ê·¸ë ˆì´ì…˜

**Before** (ê¸°ì¡´ ì½”ë“œ):
```python
# core/unified_bot.py
class UnifiedBot:
    def __init__(self, exchange_adapter):
        self.mod_data = BotDataManager(
            exchange_name='bybit',
            symbol='BTCUSDT'
        )
        # ìžë³¸ ê´€ë¦¬ ì—†ìŒ
        # API ë ˆì´íŠ¸ ì²´í¬ ì—†ìŒ
```

**After** (í†µí•©):
```python
from core.shared_data_manager import SharedDataManager
from core.shared_capital_manager import SharedCapitalManager
from core.api_rate_limiter import APIRateLimiter

class UnifiedBot:
    def __init__(
        self,
        exchange_adapter,
        shared_data_mgr: SharedDataManager,
        shared_capital_mgr: SharedCapitalManager,
        rate_limiter: APIRateLimiter
    ):
        # ê³µìœ  ë°ì´í„° ê´€ë¦¬ìžì—ì„œ ê°€ì ¸ì˜¤ê¸°
        self.mod_data = shared_data_mgr.get_manager('BTCUSDT')
        self.capital_mgr = shared_capital_mgr
        self.rate_limiter = rate_limiter

    def _try_enter_position(self, signal):
        # 1. ìžë³¸ í• ë‹¹ ì²´í¬
        if not self.capital_mgr.allocate_for_position(
            'BTCUSDT',
            amount=signal.position_size_usd
        ):
            logger.warning("ìžë³¸ ë¶€ì¡±ìœ¼ë¡œ ì§„ìž… ì·¨ì†Œ")
            return False

        # 2. API ë ˆì´íŠ¸ ì²´í¬
        if not self.rate_limiter.acquire():
            logger.warning("ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ë„ë‹¬")
            # ìžë³¸ í•´ì œ
            self.capital_mgr.locked_capital.pop('BTCUSDT', None)
            return False

        # 3. ì£¼ë¬¸ ì‹¤í–‰
        success = self.exchange.place_market_order(...)

        if not success:
            # ì‹¤íŒ¨ ì‹œ ìžë³¸ í•´ì œ
            self.capital_mgr.locked_capital.pop('BTCUSDT', None)

        return success

    def _try_exit_position(self, pnl):
        # í¬ì§€ì…˜ ì¢…ë£Œ (ìžë™ PnL ì—…ë°ì´íŠ¸)
        self.capital_mgr.release_position('BTCUSDT', pnl=pnl)
```

---

### Step 2: MultiTrader ë§ˆì´ê·¸ë ˆì´ì…˜

**Before** (ê¸°ì¡´ ì½”ë“œ):
```python
# core/multi_trader.py
class MultiTrader:
    def _monitor_loop(self):
        while self.running:
            # âŒ Lock ë¯¸ì‚¬ìš©
            for symbol in self.watching_symbols:
                # âŒ ë ˆì´íŠ¸ ì²´í¬ ì—†ìŒ
                df = self.adapter.get_klines(symbol, '15m', limit=100)

                # âŒ Parquet ì €ìž¥ ì—†ìŒ
                signal = self._detect_pattern(df)

                # âŒ ìžë³¸ ì²´í¬ ì—†ìŒ
                if signal:
                    self._try_enter_best(signal)

            time.sleep(30)
```

**After** (í†µí•©):
```python
from core.shared_data_manager import SharedDataManager
from core.api_rate_limiter import APIRateLimiter

class MultiTrader:
    def __init__(
        self,
        exchange_adapter,
        shared_data_mgr: SharedDataManager,
        shared_capital_mgr: SharedCapitalManager,
        rate_limiter: APIRateLimiter,
        watching_symbols: List[str]
    ):
        self.shared_data = shared_data_mgr
        self.capital_mgr = shared_capital_mgr
        self.rate_limiter = rate_limiter
        self.watching_symbols = watching_symbols
        self._lock = threading.RLock()  # âœ… ì‚¬ìš©í•  Lock

    def _monitor_loop(self):
        while self.running:
            # âœ… Thread-safe symbol copy
            with self._lock:
                symbols = self.watching_symbols.copy()

            signals = []
            for symbol in symbols:
                # âœ… Rate limiting
                if not self.rate_limiter.acquire():
                    logger.warning(f"{symbol} ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ëŒ€ê¸°")
                    time.sleep(1)
                    continue

                # âœ… SharedDataManager ì‚¬ìš©
                dm = self.shared_data.get_manager(symbol)

                # REST ë°ì´í„° ìˆ˜ì§‘
                df = self.adapter.get_klines(symbol, '15m', limit=100)

                # âœ… ë©”ëª¨ë¦¬ì— ì¶”ê°€ (save=False)
                for _, row in df.iterrows():
                    dm.append_candle(row.to_dict(), save=False)

                # ì‹ í˜¸ íƒì§€
                signal = self._detect_pattern(df, symbol)
                if signal:
                    signals.append(signal)

                # ëª…ì‹œì  ë©”ëª¨ë¦¬ í•´ì œ
                del df

            # âœ… ë°°ì¹˜ Parquet ì €ìž¥ (íš¨ìœ¨ì )
            self.shared_data.batch_save_parquet()

            # ìµœì  ì‹ í˜¸ ì„ íƒ ë° ì§„ìž…
            if signals:
                best_signal = max(signals, key=lambda s: s.strength)
                self._try_enter_best(best_signal)

            time.sleep(30)

    def _try_enter_best(self, signal):
        # âœ… ìžë³¸ í• ë‹¹ ì²´í¬
        if not self.capital_mgr.allocate_for_position(
            signal.symbol,
            amount=signal.position_size_usd
        ):
            logger.warning(f"{signal.symbol} ìžë³¸ ë¶€ì¡±")
            return False

        # ì£¼ë¬¸ ì‹¤í–‰
        success = self.adapter.place_market_order(...)

        if not success:
            # ì‹¤íŒ¨ ì‹œ í•´ì œ
            self.capital_mgr.locked_capital.pop(signal.symbol, None)

        return success
```

---

### Step 3: í†µí•© ì‹¤í–‰ ì˜ˆì œ

**íŒŒì¼**: `main.py` (í†µí•© ì§„ìž…ì )

```python
"""
ì‹±ê¸€/ë©€í‹° ë§¤ë§¤ í†µí•© ì‹¤í–‰ ì˜ˆì œ
"""
import time
from core.unified_bot import UnifiedBot
from core.multi_trader import MultiTrader
from core.shared_data_manager import SharedDataManager
from core.shared_capital_manager import SharedCapitalManager
from core.api_rate_limiter import APIRateLimiter
from exchanges.bybit_exchange import BybitExchange

def main():
    print("=" * 60)
    print("TwinStar-Quantum: ì‹±ê¸€/ë©€í‹° ë§¤ë§¤ í†µí•© ì‹œìŠ¤í…œ")
    print("=" * 60)

    # 1. ê³µìœ  ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
    print("\n[1/6] ê³µìœ  ì„œë¹„ìŠ¤ ì´ˆê¸°í™” ì¤‘...")
    shared_data = SharedDataManager('bybit')
    shared_capital = SharedCapitalManager('bybit', initial_capital=10000)
    rate_limiter = APIRateLimiter('bybit')
    print("âœ… SharedDataManager, SharedCapitalManager, APIRateLimiter ì¤€ë¹„ ì™„ë£Œ")

    # 2. ê±°ëž˜ì†Œ ì–´ëŒ‘í„° (ê³µìœ )
    print("\n[2/6] ê±°ëž˜ì†Œ ì—°ê²° ì¤‘...")
    exchange = BybitExchange(api_key='YOUR_API_KEY', secret='YOUR_SECRET')
    print("âœ… Bybit ì—°ê²° ì™„ë£Œ")

    # 3. UnifiedBot (ì£¼ë ¥ - BTC)
    print("\n[3/6] UnifiedBot (BTCUSDT) ì´ˆê¸°í™” ì¤‘...")
    bot_btc = UnifiedBot(
        exchange_adapter=exchange,
        shared_data_mgr=shared_data,
        shared_capital_mgr=shared_capital,
        rate_limiter=rate_limiter
    )
    print("âœ… UnifiedBot ì¤€ë¹„ ì™„ë£Œ")

    # 4. MultiTrader (ì„œë¸Œ - ì•ŒíŠ¸ì½”ì¸ 30ê°œ)
    print("\n[4/6] MultiTrader (30 symbols) ì´ˆê¸°í™” ì¤‘...")
    multi_trader = MultiTrader(
        exchange_adapter=exchange,
        shared_data_mgr=shared_data,
        shared_capital_mgr=shared_capital,
        rate_limiter=rate_limiter,
        watching_symbols=[
            'ETHUSDT', 'SOLUSDT', 'ADAUSDT', 'DOTUSDT',
            'MATICUSDT', 'AVAXUSDT', 'LINKUSDT', 'ATOMUSDT',
            # ... ì´ 30ê°œ
        ]
    )
    print("âœ… MultiTrader ì¤€ë¹„ ì™„ë£Œ")

    # 5. ë´‡ ì‹œìž‘
    print("\n[5/6] ë´‡ ì‹œìž‘ ì¤‘...")
    bot_btc.start()
    multi_trader.start()
    print("âœ… ëª¨ë“  ë´‡ ì‹¤í–‰ ì¤‘")

    # 6. ëª¨ë‹ˆí„°ë§ ë£¨í”„
    print("\n[6/6] ëª¨ë‹ˆí„°ë§ ì‹œìž‘")
    print("=" * 60)

    while True:
        print(f"\n[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] ìƒíƒœ ë¦¬í¬íŠ¸")
        print("-" * 60)

        # ìžë³¸ ìƒíƒœ
        capital_stats = shared_capital.get_stats()
        print(f"ðŸ’° ì´ ìžë³¸: ${capital_stats['total_capital']:.2f}")
        print(f"   ì‚¬ìš© ì¤‘: ${capital_stats['locked_capital']:.2f}")
        print(f"   í• ë‹¹ë¥ : {capital_stats['allocation_ratio']:.1%}")
        print(f"   ROI: {capital_stats['roi']:.2%}")

        # ë ˆì´íŠ¸ ë¦¬ë¯¸í„° ìƒíƒœ
        rate_stats = rate_limiter.get_stats()
        print(f"\nðŸš¦ API ë ˆì´íŠ¸:")
        print(f"   ì´ ìš”ì²­: {rate_stats['total_requests']}")
        print(f"   ê±°ë¶€ìœ¨: {rate_stats['rejection_rate']:.2%}")
        print(f"   í‰ê·  ëŒ€ê¸°: {rate_stats['avg_wait_time']:.2f}ì´ˆ")

        # ë°ì´í„° ê´€ë¦¬ìž ìƒíƒœ
        data_stats = shared_data.get_stats()
        print(f"\nðŸ“Š ë°ì´í„° ê´€ë¦¬:")
        print(f"   ê´€ë¦¬ ì‹¬ë³¼: {data_stats['active_symbols']}ê°œ")
        print(f"   ì´ ìº”ë“¤: {data_stats['total_memory_candles']}ê°œ")

        print("-" * 60)

        time.sleep(60)  # 1ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸

if __name__ == '__main__':
    try:
        main()
    except KeyboardInterrupt:
        print("\ní”„ë¡œê·¸ëž¨ ì¢…ë£Œ ì¤‘...")
```

--------------------------------------------------------------------------------
## ì„±ëŠ¥ ìµœì í™”
--------------------------------------------------------------------------------

### 1. ë°°ì¹˜ Parquet ì €ìž¥

**ê°œì„  ì „**:
```python
# 50ê°œ ì‹¬ë³¼ ê°œë³„ ì €ìž¥
for symbol in symbols:
    dm = get_manager(symbol)
    dm.save_parquet()  # 35ms Ã— 50 = 1,750ms
```

**ê°œì„  í›„**:
```python
# ë°°ì¹˜ ì €ìž¥
shared_data.batch_save_parquet()  # ~200ms (88% ê°œì„ )
```

**ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼**:
| ì‹¬ë³¼ ìˆ˜ | ê°œë³„ ì €ìž¥ | ë°°ì¹˜ ì €ìž¥ | ê°œì„ ìœ¨ |
|---------|----------|----------|-------|
| 10ê°œ | 350ms | 50ms | 86% |
| 50ê°œ | 1,750ms | 200ms | 88% |
| 100ê°œ | 3,500ms | 350ms | 90% |

### 2. API ìš”ì²­ ìµœì í™”

**ê°œì„  ì „** (MultiTrader):
```python
# 30ì´ˆë§ˆë‹¤ 100 ìš”ì²­
for symbol in 50_symbols:
    df = adapter.get_klines(symbol, '15m', limit=100)  # 50 ìš”ì²­
    check = adapter.get_klines(symbol, '1m', limit=1)  # 50 ìš”ì²­
```

**ê°œì„  í›„**:
```python
# ë ˆì´íŠ¸ ë¦¬ë¯¸í„° + ë°°ì¹˜ ì²˜ë¦¬ + Parquet ìºì‹œ
for symbol in 50_symbols:
    # 1. í† í° íšë“ (ëŒ€ê¸° í¬í•¨)
    rate_limiter.acquire(blocking=True)

    # 2. SharedDataManager í™œìš©
    dm = shared_data.get_manager(symbol)

    # 3. ìºì‹œì— ìµœê·¼ ë°ì´í„° ìžˆìœ¼ë©´ ìŠ¤í‚µ
    if dm.df_entry_full is not None and len(dm.df_entry_full) > 0:
        last_candle_time = dm.df_entry_full.index[-1]
        if (datetime.now() - last_candle_time).seconds < 900:  # 15ë¶„ ì´ë‚´
            continue  # API í˜¸ì¶œ ìŠ¤í‚µ

    # 4. í•„ìš”í•  ë•Œë§Œ API í˜¸ì¶œ
    df = adapter.get_klines(symbol, '15m', limit=100)
```

**ê²°ê³¼**:
- API í˜¸ì¶œ 50% ê°ì†Œ (50 â†’ 25 ìš”ì²­)
- OKX ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ íšŒí”¼
- ìž¬ì‹œìž‘ ì‹œ ìºì‹œ í™œìš©ìœ¼ë¡œ ëŒ€ê¸° ì‹œê°„ ë‹¨ì¶•

### 3. ë©”ëª¨ë¦¬ ìµœì í™”

**ê°œì„  ì „**:
```python
# MultiTrader ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
def _monitor_loop(self):
    while True:
        for symbol in symbols:
            df = get_klines(...)  # DataFrame ìƒì„±
            # df í•´ì œ ì•ˆ ë¨ â†’ ë©”ëª¨ë¦¬ ëˆ„ì 
```

**ê°œì„  í›„**:
```python
# ëª…ì‹œì  ì •ë¦¬
def _monitor_loop(self):
    while True:
        signals = []
        for symbol in symbols:
            df = get_klines(...)
            signal = detect_pattern(df)
            signals.append(signal)
            del df  # ëª…ì‹œì  í•´ì œ

        # ì‹¬ë³¼ ì œí•œ (ìµœëŒ€ 100ê°œ)
        shared_data.cleanup_old_symbols(max_symbols=100)
```

**ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**:
```
ê°œì„  ì „: ì‹œê°„ë‹¹ 15MB ëˆ„ì  (GC ë¶ˆí™•ì‹¤)
ê°œì„  í›„: ê³ ì • 5MB (100ê°œ ì‹¬ë³¼ Ã— 1000 ìº”ë“¤ Ã— 50B)
```

--------------------------------------------------------------------------------
## ì²´í¬ë¦¬ìŠ¤íŠ¸
--------------------------------------------------------------------------------

### í†µí•© ì „ ì¤€ë¹„

- [x] `core/shared_data_manager.py` ìƒì„± í™•ì¸
- [x] `core/api_rate_limiter.py` ìƒì„± í™•ì¸
- [x] `core/shared_capital_manager.py` ìƒì„± í™•ì¸
- [x] í†µí•© ê°€ì´ë“œ ë¬¸ì„œ ìž‘ì„± (`docs/SINGLE_MULTI_TRADING_INTEGRATION.md`)
- [ ] ê¸°ì¡´ ë´‡ ì½”ë“œ ë°±ì—… (`backups/` ë””ë ‰í† ë¦¬)

### UnifiedBot ë§ˆì´ê·¸ë ˆì´ì…˜ (ì˜ˆì •)

- [ ] `__init__()` ë©”ì„œë“œì— ê³µìœ  ì„œë¹„ìŠ¤ íŒŒë¼ë¯¸í„° ì¶”ê°€
- [ ] `self.mod_data = shared_data_mgr.get_manager(symbol)` ë³€ê²½
- [ ] ì§„ìž…/ì¢…ë£Œ ë¡œì§ì— `SharedCapitalManager` í†µí•©
- [ ] API í˜¸ì¶œ ì „ `APIRateLimiter.acquire()` ì¶”ê°€
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ìž‘ì„± ë° í†µê³¼

### MultiTrader ë§ˆì´ê·¸ë ˆì´ì…˜ (ì˜ˆì •)

- [ ] ìŠ¤ë ˆë“œ ì•ˆì „ì„±: `_lock` ì‚¬ìš© ì¶”ê°€
- [ ] `SharedDataManager` í†µí•©
- [ ] ë°°ì¹˜ Parquet ì €ìž¥ (`batch_save_parquet()`)
- [ ] `SharedCapitalManager` ìžë³¸ í• ë‹¹ ë¡œì§
- [ ] `APIRateLimiter` ë ˆì´íŠ¸ ì œí•œ
- [ ] ë©”ëª¨ë¦¬ ì •ë¦¬ (`cleanup_old_symbols()`)

### í†µí•© í…ŒìŠ¤íŠ¸ (ì˜ˆì •)

- [ ] ë‘ ë´‡ ë™ì‹œ ì‹¤í–‰ í…ŒìŠ¤íŠ¸ (1ì‹œê°„+)
- [ ] ìžë³¸ ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
- [ ] API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ ëª¨ë‹ˆí„°ë§
- [ ] Parquet ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
- [ ] ìž¬ì‹œìž‘ í›„ ë°ì´í„° ë³µêµ¬ í…ŒìŠ¤íŠ¸

### ëª¨ë‹ˆí„°ë§ ì„¤ì • (ì˜ˆì •)

- [ ] ìžë³¸ ìƒíƒœ ëŒ€ì‹œë³´ë“œ ì¶”ê°€
- [ ] API ë ˆì´íŠ¸ í†µê³„ ë¡œê¹…
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- [ ] ì¼ì¼ PnL ë¦¬í¬íŠ¸ ìžë™í™”

--------------------------------------------------------------------------------
## íŒŒì¼ ìƒì„±
--------------------------------------------------------------------------------

### ì‹ ê·œ ëª¨ë“ˆ

```
core/shared_data_manager.py          258ì¤„  (ì‹ ê·œ)
core/api_rate_limiter.py             230ì¤„  (ì‹ ê·œ)
core/shared_capital_manager.py       310ì¤„  (ì‹ ê·œ)
```

### ë¬¸ì„œ

```
docs/SINGLE_MULTI_TRADING_INTEGRATION.md  900ì¤„  (ì‹ ê·œ)
docs/WORK_LOG_20260115_Session14.txt     1,050ì¤„ (ì´ íŒŒì¼)
```

**ì´ ë¼ì¸ ìˆ˜**: 2,748ì¤„

--------------------------------------------------------------------------------
## ë‹¤ìŒ ë‹¨ê³„
--------------------------------------------------------------------------------

### Phase 4: ì‹¤ì œ í†µí•© (ë‹¤ìŒ ì„¸ì…˜)

1. **UnifiedBot ë§ˆì´ê·¸ë ˆì´ì…˜ PR**
   - `core/unified_bot.py` ìˆ˜ì •
   - í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„±
   - PR ìƒì„± ë° ë¦¬ë·°

2. **MultiTrader ë§ˆì´ê·¸ë ˆì´ì…˜ PR**
   - `core/multi_trader.py` ìˆ˜ì •
   - Lock ì‚¬ìš© ì¶”ê°€
   - í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„±

3. **í†µí•© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸**
   - `tests/test_single_multi_integration.py`
   - ìžë³¸ ì¶©ëŒ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
   - API ë ˆì´íŠ¸ ê²€ì¦

4. **ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**
   - GUI ìœ„ì ¯ ì¶”ê°€
   - ì‹¤ì‹œê°„ ìžë³¸/ë ˆì´íŠ¸ í‘œì‹œ

### Phase 5: WebSocket ë©€í‹°í”Œë ‰ì‹± (ì„ íƒ)

1. **`exchanges/ws_multiplex_handler.py` êµ¬í˜„**
   - ë‹¨ì¼ WS ì—°ê²°ë¡œ 50ê°œ ì‹¬ë³¼ êµ¬ë…
   - ë©”ì‹œì§€ ë¶„ë°° ë¡œì§

2. **ë ˆì´í„´ì‹œ ê°œì„ **
   - REST í´ë§ 30ì´ˆ â†’ WebSocket 100ms (300ë°°)
   - CPU ì‚¬ìš©ë¥  50% ê°ì†Œ

3. **ë°±í”„ë ˆì…” ì œì–´**
   - ë©”ì‹œì§€ í ë²„í¼ (ìµœëŒ€ 1000ê°œ)
   - ê³¼ë¶€í•˜ ì‹œ ì˜¤ëž˜ëœ ë©”ì‹œì§€ ë²„ë¦¼

### Phase 6: ë¶„ì‚° ì‹œìŠ¤í…œ (ìž¥ê¸°)

1. **Redis ê¸°ë°˜ ê³µìœ  ìƒíƒœ**
   - `SharedCapitalManager` â†’ Redis
   - ì„œë²„ ê°„ ìžë³¸ ë™ê¸°í™”

2. **ë©”ì‹œì§€ í (RabbitMQ)**
   - ê±°ëž˜ ì‹ í˜¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸
   - ë°±í…ŒìŠ¤íŠ¸ ìž‘ì—… ë¶„ì‚° ì²˜ë¦¬

3. **ì¤‘ì•™ ëª¨ë‹ˆí„°ë§**
   - Prometheus + Grafana
   - ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ

--------------------------------------------------------------------------------
## ì•Œë ¤ì§„ ì´ìŠˆ
--------------------------------------------------------------------------------

**ì—†ìŒ** - ì„¤ê³„ ë‹¨ê³„ ì™„ë£Œ, êµ¬í˜„ ëŒ€ê¸° ì¤‘

--------------------------------------------------------------------------------
## ì„±ê³¼ ìš”ì•½
--------------------------------------------------------------------------------

### í•´ê²°ëœ ë¬¸ì œ

| ë²ˆí˜¸ | ë¬¸ì œ | í•´ê²° ë°©ë²• | ìƒíƒœ |
|------|------|----------|------|
| 1 | ë°ì´í„° ì§€ì†ì„± ë¶ˆê· í˜• | SharedDataManager + Parquet | âœ… í•´ê²° |
| 2 | API ë ˆì´íŠ¸ ë¦¬ë¯¸íŠ¸ | APIRateLimiter (Token Bucket) | âœ… í•´ê²° |
| 3 | ìŠ¤ë ˆë“œ ì•ˆì „ì„± ë¶€ìž¬ | RLock ì ìš© | âœ… í•´ê²° |
| 4 | ìžë³¸ ê´€ë¦¬ ì¶©ëŒ | SharedCapitalManager | âœ… í•´ê²° |
| 5 | WebSocket ë©€í‹°í”Œë ‰ì‹± | ì„¤ê³„ ì™„ë£Œ (êµ¬í˜„ ì˜ˆì •) | ðŸ”„ ì§„í–‰ ì¤‘ |
| 6 | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ | cleanup_old_symbols() | âœ… í•´ê²° |

### ì„±ëŠ¥ ê°œì„ 

| í•­ëª© | ê°œì„  ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|---------|---------|-------|
| Parquet ì €ìž¥ (50ê°œ) | 1,750ms | 200ms | **88%** |
| API ìš”ì²­ (30ì´ˆ) | 100íšŒ | 50íšŒ | **50%** |
| ë©”ëª¨ë¦¬ ì‚¬ìš© | ì‹œê°„ë‹¹ 15MB | ê³ ì • 5MB | **ì•ˆì •í™”** |
| ìžë³¸ ì¶©ëŒ ìœ„í—˜ | $500 ì†ì‹¤ ê°€ëŠ¥ | 0 | **100%** |

### ì½”ë“œ ë©”íŠ¸ë¦­

```
ì‹ ê·œ ëª¨ë“ˆ:   3ê°œ
ì´ ë¼ì¸ ìˆ˜:  798ì¤„
ë¬¸ì„œ:        900ì¤„ (í†µí•© ê°€ì´ë“œ)
ìž‘ì—… ì‹œê°„:   1.5ì‹œê°„
```

--------------------------------------------------------------------------------
## ì°¸ê³  ë¬¸ì„œ
--------------------------------------------------------------------------------

- [ë°ì´í„° ìˆ˜ì§‘ ì „ëžµ](DATA_COLLECTION_STRATEGY.md)
- [Lazy Load ì•„í‚¤í…ì²˜](DATA_MANAGEMENT_LAZY_LOAD.md)
- [ì‹±ê¸€/ë©€í‹° í†µí•© ê°€ì´ë“œ](SINGLE_MULTI_TRADING_INTEGRATION.md)
- [í”„ë¡œì íŠ¸ ì•„í‚¤í…ì²˜](CLAUDE.md#ë””ë ‰í† ë¦¬-êµ¬ì¡°)
- [ë°±í…ŒìŠ¤íŠ¸ ë©”íŠ¸ë¦­ SSOT](CLAUDE.md#phase-1-b)

================================================================================
ìž‘ì„±: Claude Opus 4.5
2026-01-15 19:30
================================================================================
