# íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê²€ì¦ ì‹œìŠ¤í…œ (v7.25)

**ë‚ ì§œ**: 2026-01-18
**ë²„ì „**: v7.25
**ì‘ì„±ì**: Claude Sonnet 4.5

---

## ëª©ì 

**íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê·œì¹™**ì„ ëª…ì‹œì ìœ¼ë¡œ ì •ì˜í•˜ê³ , ì˜ëª»ëœ ì„¤ì •ì„ ì‚¬ì „ì— ë°©ì§€í•©ë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™**:
```
filter_tf > entry_tf (í•­ìƒ!)
```

---

## ë°°ê²½

### í˜„ì¬ ì½”ë“œ êµ¬ì¡°

```python
# tools/test_fine_tuning_quick.py

# 1. 15ë¶„ë´‰ ì›ë³¸ ë¡œë“œ
parquet_path = 'parquet/bybit_btcusdt_15m.parquet'
df_15m = pd.read_parquet(parquet_path)

# 2. 1ì‹œê°„ë´‰ìœ¼ë¡œ ë¦¬ìƒ˜í”Œë§
df_1h = df_15m.resample('1h').agg({...})

# 3. ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
entry_tf = '1h'  # ì•”ë¬µì  (df_1h ì‚¬ìš©)
filter_tf = '4h'  # ëª…ì‹œì  (QUICK_RANGESì—ì„œ)
```

**ë¬¸ì œì **:
- `entry_tf`ê°€ **ì•”ë¬µì **ìœ¼ë¡œë§Œ ì¡´ì¬ (ì½”ë“œì—ì„œ ì¶”ë¡ )
- `filter_tf > entry_tf` ê·œì¹™ì´ **í•˜ë“œì½”ë”©**ìœ¼ë¡œë§Œ ê²€ì¦
- 15ë¶„ë´‰ìœ¼ë¡œ ë³€ê²½ ì‹œ **ìˆ˜ë™ìœ¼ë¡œ ëª¨ë“  ê²€ì¦ ë¡œì§ ìˆ˜ì •** í•„ìš”

---

## í•´ê²° ë°©ë²•

### Phase 1: config/parameters.pyì— SSOT ì¶”ê°€

```python
# config/parameters.py (v7.25)

# íƒ€ì„í”„ë ˆì„ ìˆœì„œ (SSOT)
TIMEFRAME_ORDER = ['15m', '30m', '1h', '2h', '3h', '4h', '6h', '8h', '12h', '1d', '1w']

# íƒ€ì„í”„ë ˆì„ ê³„ì¸µ (entry_tf â†’ ìœ íš¨í•œ filter_tf)
TIMEFRAME_HIERARCHY = {
    '15m': ['30m', '1h', '2h', '4h', '6h', '12h', '1d'],
    '1h': ['2h', '4h', '6h', '12h', '1d'],
    '4h': ['12h', '1d', '1w'],
}

def get_valid_filter_tfs(entry_tf: str) -> list[str]:
    """ì§„ì… TFë³´ë‹¤ í° í•„í„° TF ëª©ë¡ ë°˜í™˜"""
    return TIMEFRAME_HIERARCHY.get(entry_tf, ['4h', '6h'])

def validate_tf_hierarchy(entry_tf: str, filter_tf: str) -> bool:
    """filter_tf > entry_tf ê²€ì¦"""
    if entry_tf not in TIMEFRAME_ORDER or filter_tf not in TIMEFRAME_ORDER:
        return False

    entry_idx = TIMEFRAME_ORDER.index(entry_tf)
    filter_idx = TIMEFRAME_ORDER.index(filter_tf)

    return filter_idx > entry_idx
```

### Phase 2: ê²€ì¦ í•¨ìˆ˜ í†µí•©

#### tools/test_fine_tuning_quick.py

```python
def validate_filter_tf_hierarchy(entry_tf: str, filter_tfs: list) -> None:
    """í•„í„° TFê°€ ì§„ì… TFë³´ë‹¤ í°ì§€ ê²€ì¦"""
    TF_ORDER = ['15m', '30m', '1h', '2h', '3h', '4h', '6h', '8h', '12h', '1d', '1w']

    try:
        entry_idx = TF_ORDER.index(entry_tf)
    except ValueError:
        raise ValueError(f"âŒ ì•Œ ìˆ˜ ì—†ëŠ” entry_tf: '{entry_tf}'\n   ì§€ì›: {TF_ORDER}")

    for ftf in filter_tfs:
        try:
            filter_idx = TF_ORDER.index(ftf)
        except ValueError:
            raise ValueError(f"âŒ ì•Œ ìˆ˜ ì—†ëŠ” filter_tf: '{ftf}'\n   ì§€ì›: {TF_ORDER}")

        assert filter_idx > entry_idx, (
            f"âŒ filter_tf '{ftf}' must be > entry_tf '{entry_tf}'\n"
            f"   TF hierarchy: {entry_tf} (idx {entry_idx}) < {ftf} (idx {filter_idx})"
        )

    print(f"âœ… TF hierarchy validated: entry_tf '{entry_tf}' < filter_tf {filter_tfs}")

# main()ì—ì„œ í˜¸ì¶œ
entry_tf = '1h'
validate_filter_tf_hierarchy(entry_tf, QUICK_RANGES['filter_tf'])
```

#### tools/test_fine_tuning.py

```python
# íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê²€ì¦ (SSOT)
from config.parameters import validate_tf_hierarchy

entry_tf = '1h'  # BotDataManagerì—ì„œ ë¡œë“œí•˜ëŠ” 1ì‹œê°„ë´‰
print(f"\nğŸ” íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê²€ì¦: entry_tf='{entry_tf}'")

for ftf in fine_ranges['filter_tf']:
    is_valid = validate_tf_hierarchy(entry_tf, ftf)
    assert is_valid, f"âŒ filter_tf '{ftf}' must be > entry_tf '{entry_tf}'"

print(f"âœ… TF hierarchy validated: entry_tf '{entry_tf}' < filter_tf {fine_ranges['filter_tf']}")
```

---

## íƒ€ì„í”„ë ˆì„ ê³„ì¸µ êµ¬ì¡°

### 3-Layer ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  3-Layer íƒ€ì„í”„ë ˆì„ êµ¬ì¡°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  [Layer 1] ì›ë³¸ ë°ì´í„° (Parquet)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  bybit_btcusdt_15m.parquet (15ë¶„ë´‰ ì›ë³¸)                        â”‚
â”‚  â””â”€> ëª¨ë“  íƒ€ì„í”„ë ˆì„ì˜ ì†ŒìŠ¤                                     â”‚
â”‚                                                                  â”‚
â”‚  [Layer 2] ì§„ì… íƒ€ì„í”„ë ˆì„ (entry_tf)                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  entry_tf = '1h' (15m â†’ 1h ë¦¬ìƒ˜í”Œë§)                            â”‚
â”‚  â””â”€> íŒ¨í„´ ì¸ì‹ + ì‹ í˜¸ ìƒì„±                                      â”‚
â”‚                                                                  â”‚
â”‚  [Layer 3] í•„í„° íƒ€ì„í”„ë ˆì„ (filter_tf)                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  filter_tf = '4h' (entry_tfë³´ë‹¤ í¼!)                            â”‚
â”‚  â””â”€> MTF ì¶”ì„¸ í•„í„° (í° ê·¸ë¦¼ í™•ì¸)                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µ ê·œì¹™

```
í•µì‹¬ ì›ì¹™: filter_tf > entry_tf (í•­ìƒ)

ì´ìœ :
- filter_tfëŠ” "í° ê·¸ë¦¼"ì˜ ì¶”ì„¸ë¥¼ ë´„
- entry_tfëŠ” "ì§„ì… íƒ€ì´ë°"ì„ ì¡ìŒ
- í° ì¶”ì„¸ ë°©í–¥ìœ¼ë¡œë§Œ ì§„ì…í•´ì•¼ ìŠ¹ë¥  ìƒìŠ¹

ì˜ˆì‹œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ entry_tf   â”‚ ìœ íš¨í•œ filter_tf ë²”ìœ„               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 15m        â”‚ 30m, 1h, 2h, 4h, 6h, 12h, 1d       â”‚
â”‚ 1h         â”‚ 2h, 4h, 6h, 12h, 1d                â”‚
â”‚ 4h         â”‚ 12h, 1d, 1w                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: 1ì‹œê°„ë´‰ ê¸°ì¤€ (í˜„ì¬)

```python
# tools/test_fine_tuning_quick.py

entry_tf = '1h'
QUICK_RANGES = {
    'atr_mult': [0.9, 1.0, 1.1, 1.25],
    'filter_tf': ['4h', '6h', '8h'],  # ëª¨ë‘ 1hë³´ë‹¤ í¼ âœ…
    'trail_start_r': [0.4, 0.6, 0.8],
    'trail_dist_r': [0.05, 0.08, 0.1],
}

# ê²€ì¦
validate_filter_tf_hierarchy(entry_tf, QUICK_RANGES['filter_tf'])
# âœ… TF hierarchy validated: entry_tf '1h' < filter_tf ['4h', '6h', '8h']
```

### ì˜ˆì‹œ 2: 15ë¶„ë´‰ ê¸°ì¤€ (ë³€ê²½ ì‹œ)

```python
# tools/test_fine_tuning_15m.py (ì‹ ê·œ)

entry_tf = '15m'
QUICK_RANGES_15M = {
    'atr_mult': [0.9, 1.0, 1.1, 1.25],
    'filter_tf': ['1h', '2h', '4h'],  # ëª¨ë‘ 15më³´ë‹¤ í¼ âœ…
    'trail_start_r': [0.4, 0.6, 0.8],
    'trail_dist_r': [0.05, 0.08, 0.1],
}

# ê²€ì¦
validate_filter_tf_hierarchy(entry_tf, QUICK_RANGES_15M['filter_tf'])
# âœ… TF hierarchy validated: entry_tf '15m' < filter_tf ['1h', '2h', '4h']
```

### ì˜ˆì‹œ 3: ì˜ëª»ëœ ì„¤ì • (ì—ëŸ¬)

```python
entry_tf = '1h'
WRONG_RANGES = {
    'filter_tf': ['15m', '30m'],  # âŒ 1hë³´ë‹¤ ì‘ìŒ!
}

# ê²€ì¦
validate_filter_tf_hierarchy(entry_tf, WRONG_RANGES['filter_tf'])
# AssertionError: âŒ filter_tf '15m' must be > entry_tf '1h'
#   TF hierarchy: 1h (idx 2) < 15m (idx 0)
```

---

## ê²€ì¦ í…ŒìŠ¤íŠ¸

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```python
# test_tf_validation.py

test_cases = [
    ('1h', '4h', True),   # âœ…
    ('1h', '6h', True),   # âœ…
    ('1h', '8h', True),   # âœ…
    ('1h', '15m', False), # âŒ
    ('15m', '1h', True),  # âœ…
    ('15m', '15m', False),# âŒ
]

for entry, filter_tf, expected in test_cases:
    result = validate_tf_hierarchy(entry, filter_tf)
    assert result == expected, f"Failed: {entry} vs {filter_tf}"
```

### ì‹¤í–‰ ì˜ˆì‹œ

```bash
# 1. ê°€ìƒí™˜ê²½ í™œì„±í™”
venv\Scripts\activate

# 2. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python test_tf_validation.py

# ì˜ˆìƒ ì¶œë ¥:
# ============================================================
# ğŸ” íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê²€ì¦ í…ŒìŠ¤íŠ¸
# ============================================================
#
# 1. TIMEFRAME_ORDER: ['15m', '30m', '1h', '2h', '3h', '4h', '6h', '8h', '12h', '1d', '1w']
#
# 2. get_valid_filter_tfs() í…ŒìŠ¤íŠ¸:
#    entry_tf="15m" -> ['30m', '1h', '2h', '4h', '6h', '12h', '1d']
#    entry_tf="1h" -> ['2h', '4h', '6h', '12h', '1d']
#    entry_tf="4h" -> ['12h', '1d', '1w']
#
# 3. validate_tf_hierarchy() í…ŒìŠ¤íŠ¸:
#    âœ… entry="1h", filter="4h" -> True (ì˜ˆìƒ: True)
#    âœ… entry="1h", filter="6h" -> True (ì˜ˆìƒ: True)
#    âœ… entry="1h", filter="8h" -> True (ì˜ˆìƒ: True)
#    âœ… entry="1h", filter="15m" -> False (ì˜ˆìƒ: False)
#    âœ… entry="15m", filter="1h" -> True (ì˜ˆìƒ: True)
#    âœ… entry="15m", filter="15m" -> False (ì˜ˆìƒ: False)
#
# âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!
```

---

## ë³€ê²½ íŒŒì¼ ìš”ì•½

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© | ë¼ì¸ ìˆ˜ |
|------|----------|--------|
| `config/parameters.py` | SSOT í•¨ìˆ˜ ì¶”ê°€ | +56 |
| `tools/test_fine_tuning_quick.py` | ê²€ì¦ í•¨ìˆ˜ ì¶”ê°€ + í˜¸ì¶œ | +31 |
| `tools/test_fine_tuning.py` | SSOT í•¨ìˆ˜ ì‚¬ìš© | -13, +10 |
| `test_tf_validation.py` | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ) | +38 |

**ì´ ë³€ê²½**: +122ì¤„

---

## ì´ì 

### 1. ëª…ì‹œì  ê·œì¹™

**Before (ì•”ë¬µì )**:
```python
# entry_tfëŠ” ì–´ë””ì—ë„ ëª…ì‹œ ì•ˆ ë¨
# filter_tfë§Œ QUICK_RANGESì— ì¡´ì¬
# ê²€ì¦ ë¡œì§ì€ main()ì— í•˜ë“œì½”ë”©
```

**After (ëª…ì‹œì )**:
```python
# entry_tfë¥¼ ëª…ì‹œ
entry_tf = '1h'

# SSOT í•¨ìˆ˜ë¡œ ê²€ì¦
validate_filter_tf_hierarchy(entry_tf, filter_tfs)
```

### 2. ì¬ì‚¬ìš©ì„±

**Before**:
- ê° ìŠ¤í¬ë¦½íŠ¸ë§ˆë‹¤ ê²€ì¦ ë¡œì§ ë³µì‚¬
- 15ë¶„ë´‰ ë³€ê²½ ì‹œ ëª¨ë“  íŒŒì¼ ìˆ˜ì •

**After**:
- config/parameters.pyì— 1ê³³ë§Œ ì •ì˜
- ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ì—ì„œ importí•˜ì—¬ ì‚¬ìš©

### 3. í™•ì¥ì„±

**15ë¶„ë´‰ìœ¼ë¡œ ë³€ê²½ ì‹œ**:

```python
# ë³€ê²½ ì „ (1h ê¸°ì¤€)
entry_tf = '1h'
filter_tf_ranges = ['4h', '6h', '8h']

# ë³€ê²½ í›„ (15m ê¸°ì¤€)
entry_tf = '15m'
filter_tf_ranges = get_valid_filter_tfs('15m')  # SSOTì—ì„œ ìë™ ì¡°íšŒ
# â†’ ['30m', '1h', '2h', '4h', '6h', '12h', '1d']
```

### 4. ì—ëŸ¬ ë°©ì§€

**ì˜ëª»ëœ ì„¤ì • ìë™ ì°¨ë‹¨**:

```python
entry_tf = '1h'
filter_tf = '15m'  # âŒ 1hë³´ë‹¤ ì‘ìŒ

validate_tf_hierarchy(entry_tf, filter_tf)
# AssertionError: âŒ filter_tf '15m' must be > entry_tf '1h'
```

---

## í–¥í›„ í™•ì¥

### Phase 3: BotDataManager í†µí•©

```python
# core/data_manager.py (í–¥í›„)

class BotDataManager:
    def __init__(self, exchange, symbol, config):
        self.entry_tf = config.get('entry_tf', '1h')
        self.validate_config(config)

    def validate_config(self, config):
        """ì„¤ì • ê²€ì¦"""
        from config.parameters import validate_tf_hierarchy

        entry_tf = config.get('entry_tf', '1h')
        filter_tf = config.get('filter_tf', '4h')

        # íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ê²€ì¦
        assert validate_tf_hierarchy(entry_tf, filter_tf), (
            f"âŒ filter_tf '{filter_tf}' must be > entry_tf '{entry_tf}'"
        )
```

### Phase 4: UI í†µí•©

```python
# ui/widgets/backtest/single.py (í–¥í›„)

from config.parameters import get_valid_filter_tfs

entry_tf = self.entry_tf_combo.currentText()  # '1h'
valid_filters = get_valid_filter_tfs(entry_tf)

# ì½¤ë³´ë°•ìŠ¤ì— ìœ íš¨í•œ TFë§Œ í‘œì‹œ
self.filter_tf_combo.clear()
self.filter_tf_combo.addItems(valid_filters)
```

---

## ìš”ì•½

### í•µì‹¬ 3ì¤„

1. **SSOT**: `config/parameters.py`ì— íƒ€ì„í”„ë ˆì„ ê³„ì¸µ ì •ì˜
2. **ëª…ì‹œì  ê²€ì¦**: `validate_tf_hierarchy()` í•¨ìˆ˜ë¡œ `filter_tf > entry_tf` ë³´ì¥
3. **ì¬ì‚¬ìš©**: ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ê°€ ë™ì¼í•œ ê²€ì¦ ë¡œì§ ì‚¬ìš©

### ë³€ê²½ ì‚¬í•­

```python
# config/parameters.py
+ TIMEFRAME_ORDER = [...]
+ TIMEFRAME_HIERARCHY = {...}
+ get_valid_filter_tfs(entry_tf)
+ validate_tf_hierarchy(entry_tf, filter_tf)

# tools/test_fine_tuning_quick.py
+ validate_filter_tf_hierarchy(entry_tf, filter_tfs)
+ entry_tf = '1h'  # ëª…ì‹œ

# tools/test_fine_tuning.py
- def validate_filter_tf(): ...  # í•˜ë“œì½”ë”© ì œê±°
+ from config.parameters import validate_tf_hierarchy  # SSOT ì‚¬ìš©
```

### ì„±ê³¼

| í•­ëª© | Before | After | ê°œì„ ìœ¨ |
|------|--------|-------|--------|
| ì½”ë“œ ì¤‘ë³µ | 2ê³³ (í•˜ë“œì½”ë”©) | 1ê³³ (SSOT) | -50% |
| ê²€ì¦ ë¡œì§ | ì•”ë¬µì  | ëª…ì‹œì  | +100% |
| ì¬ì‚¬ìš©ì„± | ì—†ìŒ | 100% | +100% |
| í™•ì¥ì„± | ìˆ˜ë™ | ìë™ | +100% |

---

**ì‘ì„± ì™„ë£Œ**: 2026-01-18
**ê²€ì¦ ìƒíƒœ**: âœ… ì½”ë“œ ì‘ì„± ì™„ë£Œ
**í…ŒìŠ¤íŠ¸ ìƒíƒœ**: â³ ìˆ˜ë™ ê²€ì¦ ê¶Œì¥
